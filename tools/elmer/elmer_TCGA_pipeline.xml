<tool id="TCGA_pipe" name="ELMER Analysis Pipeline" version="1.0">
    <description>for a TCGA data</description>
    <macros>
        <import>elmer_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        cat "${TCGA_pipe}"
        && Rscript "${TCGA_pipe}"
        ]]></command>
    <configfiles>
        <configfile name="TCGA_pipe"><![CDATA[
library(ELMER, quietly=TRUE, warn.conflicts=FALSE,verbose = FALSE)

## IF disease type NOT available, stop.

tcga_valid = c("HNSC","BLCA","BRCA" ,"CESC" ,"COAD" ,"GBM" ,"LUSC" ,"KICH" ,"KIRC" ,"KIRP" ,"LAML" ,"SKCM" ,"LGG" ,"LIHC","LUAD","SARC","OV" ,"THCA" ,"PRAD" ,"READ" ,"UCEC" ,"STAD","PAAD")

if( !("${disease}" %in% tcga_valid )){
    cat("Valid TCGA cancer types which work with ELMER",tcga_valid)
    stop("The disease name should be from TCGA list of valid cancer types")
}

cores = "${GALAXY_SLOTS:-4}" # TODO 

ELMER::TCGA.pipe("${disease}",rm.chr=paste0("chr",c("X","Y")),wd=".", analysis = c("download", "distal.probes", "diffMeth", "pair", "motif", "TF.search"),diff.dir="${diffdir_select.diffdir}")

        ]]></configfile>
    </configfiles>
    <inputs>
        <param name="disease" size="4" type="text" value="LUAD" label="Cancer type from TCGA"/>
        <conditional name="analysis_select">
            <param name="analysis" type="select" label="Choose analysis type">
                  <option value="all">Choose all of them (Recommended option)</option>
                  <option value="distal.probes">Distal probes</option>
                  <option value="diff.meth">Differential methylation</option>
                  <option value="pair">Statistics for each probe-gene pair</option>
                  <option value="motif">Enriched motifs</option>
                  <option value="TF.search">Identify regulatory TFs</option>
            </param>
        </conditional>
        <conditional name="diffdir_select">
            <param name="diffdir" type="select" label="Choose differential Methylation direction">
                  <option value="hypo">Hypomethylation</option>
                  <option value="hyper">Hypermethylation</option>
            </param>
        </conditional>
    </inputs>
    <outputs>
        <data name="methylation" format="Rdata" label="${disease.value_label}_meth.rda" from_work_dir="./Data" />
        <data name="expression" format="Rdata" label="${disease.value_label}_RNA.rda" from_work_dir="./Data" />
        <data name="clinical" format="Rdata" label="${disease.value_label}_clinic.rda" from_work_dir="./Data" />
    </outputs>
    <help>
**What it does:**

ELMER analysis pipeline for TCGA data. This pipeline combine every steps of ELMER analyses:
get.feature.probe, get.diff.meth, get.pair, get.permu, get.enriched.motif and get.TFs. Every stepsâ€™
results are saved. This includes downloading the TCGA data.


**Input:**

*Cancer type*:  This specifies the disease to download in TCGA such as BLCA,LUAD,LUSC,BRCA etc.

*analysis*: A vector of characters listing the analysis need to be done. Analysis can be
"download","distal.probes","diffMeth","pair","motif","TF.search". Default is "all"
meaning all the analysis will be processed.


*Data*: A path shows the folder containing DNA methylation, expression and clinic data

*Choose differential Methylation direction*: A character can be "hypo" or "hyper", showing dirction DNA methylation changes. If it is "hypo", get.diff.meth function will identify all significantly hypomethylated CpG sites; If "hyper", get.diff.meth function will identify all significantly hypermethylated CpG sites


**Output:**

Different analysis results

    </help>
    <expand macro="citations" />
</tool>
